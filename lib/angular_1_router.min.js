!function(){var DirectiveIntrospectorProvider=function(){function DirectiveIntrospectorProvider(){this.directiveBuffer=[],this.directiveFactoriesByName={},this.onDirectiveRegistered=null}return DirectiveIntrospectorProvider.prototype.register=function(name,factory){angular.isArray(factory)&&(factory=factory[factory.length-1]),this.directiveFactoriesByName[name]=factory,this.onDirectiveRegistered?this.onDirectiveRegistered(name,factory):this.directiveBuffer.push({name:name,factory:factory})},DirectiveIntrospectorProvider.prototype.$get=function(){var _this=this,fn=function(newOnControllerRegistered){for(_this.onDirectiveRegistered=newOnControllerRegistered;0<_this.directiveBuffer.length;){var directive=_this.directiveBuffer.pop();_this.onDirectiveRegistered(directive.name,directive.factory)}};return fn.getTypeByName=function(name){return _this.directiveFactoriesByName[name]},fn},DirectiveIntrospectorProvider}();function dashCase(str){return str.replace(/[A-Z]/g,function(match){return"-"+match.toLowerCase()})}angular.module("ngComponentRouter",[]).directive("ngOutlet",["$animate","$q","$rootRouter",function($animate,$q,$rootRouter){var rootRouter=$rootRouter;return{restrict:"AE",transclude:"element",terminal:!0,priority:400,require:["?^^ngOutlet","ngOutlet"],link:function(scope,element,attrs,ctrls,$transclude){var Outlet=function(){function Outlet(controller,router){this.controller=controller,this.router=router}return Outlet.prototype.cleanupLastView=function(){var _this=this;this.previousLeaveAnimation&&($animate.cancel(this.previousLeaveAnimation),this.previousLeaveAnimation=null),this.currentScope&&(this.currentScope.$destroy(),this.currentScope=null),this.currentElement&&(this.previousLeaveAnimation=$animate.leave(this.currentElement),this.previousLeaveAnimation.then(function(){return _this.previousLeaveAnimation=null}),this.currentElement=null)},Outlet.prototype.reuse=function(instruction){var next=$q.when(!0),previousInstruction=this.currentInstruction;return this.currentInstruction=instruction,this.currentController&&this.currentController.$routerOnReuse&&(next=$q.when(this.currentController.$routerOnReuse(this.currentInstruction,previousInstruction))),next},Outlet.prototype.routerCanReuse=function(nextInstruction){var result;return result=!(!this.currentInstruction||this.currentInstruction.componentType!==nextInstruction.componentType)&&(this.currentController&&this.currentController.$routerCanReuse?this.currentController.$routerCanReuse(nextInstruction,this.currentInstruction):nextInstruction===this.currentInstruction||angular.equals(nextInstruction.params,this.currentInstruction.params)),$q.when(result)},Outlet.prototype.routerCanDeactivate=function(instruction){return this.currentController&&this.currentController.$routerCanDeactivate?$q.when(this.currentController.$routerCanDeactivate(instruction,this.currentInstruction)):$q.when(!0)},Outlet.prototype.deactivate=function(instruction){return this.currentController&&this.currentController.$routerOnDeactivate?$q.when(this.currentController.$routerOnDeactivate(instruction,this.currentInstruction)):$q.when()},Outlet.prototype.activate=function(instruction){var _this=this;this.previousInstruction=this.currentInstruction,this.currentInstruction=instruction;var componentName=this.controller.$$componentName=instruction.componentType;if("string"!=typeof componentName)throw new Error("Component is not a string for "+instruction.urlPath);this.controller.$$template="<"+dashCase(componentName)+' $router="::$$router"></'+dashCase(componentName)+">",this.controller.$$router=this.router.childRouter(instruction.componentType),this.controller.$$outlet=this;var newScope=scope.$new();newScope.$$router=this.controller.$$router,this.deferredActivation=$q.defer();var clone=$transclude(newScope,function(clone){$animate.enter(clone,null,_this.currentElement||element),_this.cleanupLastView()});return this.currentElement=clone,this.currentScope=newScope,this.deferredActivation.promise},Outlet}(),parentCtrl=ctrls[0],myCtrl=ctrls[1],router=parentCtrl&&parentCtrl.$$router||rootRouter;myCtrl.$$currentComponent=null,router.registerPrimaryOutlet(new Outlet(myCtrl,router))},controller:function(){},controllerAs:"$$ngOutlet"}}]).directive("ngOutlet",["$compile",function($compile){return{restrict:"EA",priority:-400,require:"ngOutlet",link:function(scope,element,attrs,ctrl){var template=ctrl.$$template;element.html(template),$compile(element.contents())(scope)}}}]).directive("ngLink",["$rootRouter","$parse",function($rootRouter,$parse){return{require:"?^^ngOutlet",restrict:"A",link:function(scope,element,attrs,ctrl){var router=ctrl&&ctrl.$$router||$rootRouter;if(router){var instruction=null,link=attrs.ngLink||"",routeParamsGetter=$parse(link);if(routeParamsGetter.constant){var params=routeParamsGetter();element.attr("href",getLink(params))}else scope.$watch(function(){return routeParamsGetter(scope)},function(params){return element.attr("href",getLink(params))},!0);element.on("click",function(event){1===event.which&&instruction&&($rootRouter.navigateByInstruction(instruction),event.preventDefault())})}function getLink(params){return instruction=router.generate(params),"./"+angular.stringifyInstruction(instruction)}}}}]).directive("$router",["$q",function($q){return{require:"^ngOutlet",priority:-1e3,link:function(scope,element,attr,ngOutletCtrl){var promise=$q.when(),outlet=ngOutletCtrl.$$outlet,currentComponent=outlet.currentController=element.controller(ngOutletCtrl.$$componentName);currentComponent.$routerOnActivate&&(promise=$q.when(currentComponent.$routerOnActivate(outlet.currentInstruction,outlet.previousInstruction))),promise.then(outlet.deferredActivation.resolve,outlet.deferredActivation.reject)}}}]),angular.module("ng").provider("$$directiveIntrospector",DirectiveIntrospectorProvider).config(["$compileProvider","$$directiveIntrospectorProvider",function($compileProvider,$$directiveIntrospectorProvider){var directive=$compileProvider.directive;$compileProvider.directive=function(name,factory){return $$directiveIntrospectorProvider.register(name,factory),directive.apply(this,arguments)}}]),angular.module("ngComponentRouter").value("$route",null).value("$routerRootComponent",new Object).factory("$rootRouter",["$q","$location","$$directiveIntrospector","$browser","$rootScope","$injector","$routerRootComponent",function($q,$location,$$directiveIntrospector,$browser,$rootScope,$injector,$routerRootComponent){function CONST_EXPR(expr){return expr}function isPresent(x){return!!x}function isBlank(x){return!x}function isString(obj){return"string"==typeof obj}function isType(x){return"function"==typeof x}function isArray(obj){return Array.isArray(obj)}function getTypeNameForDebugging(fn){return fn.name||"Root"}var PromiseWrapper={resolve:function(reason){return $q.when(reason)},reject:function(reason){return $q.reject(reason)},catchError:function(promise,fn){return promise.then(null,fn)},all:function(promises){return $q.all(promises)}},RegExpWrapper={create:function(regExpStr,flags){return flags=flags?flags.replace(/g/g,""):"",new RegExp(regExpStr,flags+"g")},firstMatch:function(regExp,input){return regExp.lastIndex=0,regExp.exec(input)},matcher:function(regExp,input){return regExp.lastIndex=0,{re:regExp,input:input}}},reflector={annotations:function(fn){return fn.annotations||[]}},StringMapWrapper={create:function(){return{}},set:function(m,k,v){return m[k]=v},get:function(m,k){return m.hasOwnProperty(k)?m[k]:void 0},contains:function(m,k){return m.hasOwnProperty(k)},keys:function(map){return Object.keys(map)},isEmpty:function(map){for(var prop in map)if(map.hasOwnProperty(prop))return!1;return!0},delete:function(map,key){delete map[key]},forEach:function(m,fn){for(var prop in m)m.hasOwnProperty(prop)&&fn(m[prop],prop)},equals:function(m1,m2){var key,k1=Object.keys(m1),k2=Object.keys(m2);if(k1.length!=k2.length)return!1;for(var i=0;i<k1.length;i++)if(key=k1[i],m1[key]!==m2[key])return!1;return!0},merge:function(m1,m2){var m={};for(var attr in m1)m1.hasOwnProperty(attr)&&(m[attr]=m1[attr]);for(var attr in m2)m2.hasOwnProperty(attr)&&(m[attr]=m2[attr]);return m}},ListWrapper=(Array,{toJSON:function(l){return JSON.stringify(l)},clear:function(l){l.length=0},create:function(){return[]},push:function(l,v){return l.push(v)},forEach:function(l,fn){return l.forEach(fn)},first:function(array){return array?array[0]:null},last:function(array){return 0<(array&&array.length)?array[array.length-1]:null},map:function(l,fn){return l.map(fn)},join:function(l,str){return l.join(str)},reduce:function(list,fn,init){return list.reduce(fn,init)},filter:function(array,pred){return array.filter(pred)},concat:function(a,b){return a.concat(b)},slice:function(l){var from=void 0!==arguments[1]?arguments[1]:0,to=void 0!==arguments[2]?arguments[2]:null;return l.slice(from,null===to?void 0:to)},maximum:function(list,predicate){if(0==list.length)return null;for(var solution=null,maxValue=-1/0,index=0;index<list.length;index++){var candidate=list[index];if(!isBlank(candidate)){var candidateValue=predicate(candidate);maxValue<candidateValue&&(solution=candidate,maxValue=candidateValue)}}return solution}}),StringWrapper={charCodeAt:function(s,i){return s.charCodeAt(i)},equals:function(s1,s2){return s1===s2},split:function(s,re){return s.split(re)},replaceAll:function(s,from,replace){return s.replace(from,replace)},replaceAllMapped:function(s,from,cb){return s.replace(from,function(matches){return matches.splice(-2,2),cb.apply(null,matches)})},contains:function(s,substr){return-1!=s.indexOf(substr)}};function EventEmitter(){}var BaseException=Error,ObservableWrapper={callNext:function(ob,val){ob.fn(val)},callEmit:function(ob,val){ob.fn(val)},subscribe:function(ob,fn){ob.fn=fn}};function Location(){}Location.prototype.subscribe=function(){},Location.prototype.path=function(){return $location.url()},Location.prototype.go=function(path,query){return $location.url(path+query)};var exports={Injectable:function(){},OpaqueToken:function(){},Inject:function(){}},require=function(){return exports},TouchMap=function(){function TouchMap(map){var _this=this;this.map={},this.keys={},isPresent(map)&&StringMapWrapper.forEach(map,function(value,key){_this.map[key]=isPresent(value)?value.toString():null,_this.keys[key]=!0})}return TouchMap.prototype.get=function(key){return StringMapWrapper.delete(this.keys,key),this.map[key]},TouchMap.prototype.getUnused=function(){var _this=this,unused={},keys=StringMapWrapper.keys(this.keys);return keys.forEach(function(key){return unused[key]=StringMapWrapper.get(_this.map,key)}),unused},TouchMap}();exports.TouchMap=TouchMap,exports.normalizeString=function(obj){return isBlank(obj)?null:obj.toString()};var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)};function convertUrlParamsToArray(urlParams){var paramsArray=[];return isBlank(urlParams)?[]:(StringMapWrapper.forEach(urlParams,function(value,key){paramsArray.push(!0===value?key:key+"="+value)}),paramsArray)}function serializeParams(urlParams,joiner){return void 0===joiner&&(joiner="&"),convertUrlParamsToArray(urlParams).join(joiner)}exports.convertUrlParamsToArray=convertUrlParamsToArray,exports.serializeParams=serializeParams;var Url=function(){function Url(path,child,auxiliary,params){void 0===child&&(child=null),void 0===auxiliary&&(auxiliary=CONST_EXPR([])),void 0===params&&(params=CONST_EXPR({})),this.path=path,this.child=child,this.auxiliary=auxiliary,this.params=params}return Url.prototype.toString=function(){return this.path+this._matrixParamsToString()+this._auxToString()+this._childString()},Url.prototype.segmentToString=function(){return this.path+this._matrixParamsToString()},Url.prototype._auxToString=function(){return 0<this.auxiliary.length?"("+this.auxiliary.map(function(sibling){return sibling.toString()}).join("//")+")":""},Url.prototype._matrixParamsToString=function(){var paramString=serializeParams(this.params,";");return 0<paramString.length?";"+paramString:""},Url.prototype._childString=function(){return isPresent(this.child)?"/"+this.child.toString():""},Url}(),RootUrl=function(_super){function RootUrl(path,child,auxiliary,params){void 0===child&&(child=null),void 0===auxiliary&&(auxiliary=CONST_EXPR([])),void 0===params&&(params=null),_super.call(this,path,child,auxiliary,params)}return __extends(RootUrl,_super),RootUrl.prototype.toString=function(){return this.path+this._auxToString()+this._childString()+this._queryParamsToString()},RootUrl.prototype.segmentToString=function(){return this.path+this._queryParamsToString()},RootUrl.prototype._queryParamsToString=function(){return isBlank(this.params)?"":"?"+serializeParams(this.params)},RootUrl}(exports.Url=Url);exports.RootUrl=RootUrl,exports.pathSegmentsToUrl=function(pathSegments){for(var url=new Url(pathSegments[pathSegments.length-1]),i=pathSegments.length-2;0<=i;i-=1)url=new Url(pathSegments[i],url);return url};var SEGMENT_RE=RegExpWrapper.create("^[^\\/\\(\\)\\?;=&#]+");function matchUrlSegment(str){var match=RegExpWrapper.firstMatch(SEGMENT_RE,str);return isPresent(match)?match[0]:""}var UrlParser=function(){function UrlParser(){}return UrlParser.prototype.peekStartsWith=function(str){return this._remaining.startsWith(str)},UrlParser.prototype.capture=function(str){if(!this._remaining.startsWith(str))throw new BaseException('Expected "'+str+'".');this._remaining=this._remaining.substring(str.length)},UrlParser.prototype.parse=function(url){return""==(this._remaining=url)||"/"==url?new Url(""):this.parseRoot()},UrlParser.prototype.parseRoot=function(){this.peekStartsWith("/")&&this.capture("/");var path=matchUrlSegment(this._remaining);this.capture(path);var aux=[];this.peekStartsWith("(")&&(aux=this.parseAuxiliaryRoutes()),this.peekStartsWith(";")&&this.parseMatrixParams();var child=null;this.peekStartsWith("/")&&!this.peekStartsWith("//")&&(this.capture("/"),child=this.parseSegment());var queryParams=null;return this.peekStartsWith("?")&&(queryParams=this.parseQueryParams()),new RootUrl(path,child,aux,queryParams)},UrlParser.prototype.parseSegment=function(){if(0==this._remaining.length)return null;this.peekStartsWith("/")&&this.capture("/");var path=matchUrlSegment(this._remaining);this.capture(path);var matrixParams=null;this.peekStartsWith(";")&&(matrixParams=this.parseMatrixParams());var aux=[];this.peekStartsWith("(")&&(aux=this.parseAuxiliaryRoutes());var child=null;return this.peekStartsWith("/")&&!this.peekStartsWith("//")&&(this.capture("/"),child=this.parseSegment()),new Url(path,child,aux,matrixParams)},UrlParser.prototype.parseQueryParams=function(){var params={};for(this.capture("?"),this.parseParam(params);0<this._remaining.length&&this.peekStartsWith("&");)this.capture("&"),this.parseParam(params);return params},UrlParser.prototype.parseMatrixParams=function(){for(var params={};0<this._remaining.length&&this.peekStartsWith(";");)this.capture(";"),this.parseParam(params);return params},UrlParser.prototype.parseParam=function(params){var key=matchUrlSegment(this._remaining);if(!isBlank(key)){this.capture(key);var value=!0;if(this.peekStartsWith("=")){this.capture("=");var valueMatch=matchUrlSegment(this._remaining);isPresent(valueMatch)&&(value=valueMatch,this.capture(value))}params[key]=value}},UrlParser.prototype.parseAuxiliaryRoutes=function(){var routes=[];for(this.capture("(");!this.peekStartsWith(")")&&0<this._remaining.length;)routes.push(this.parseSegment()),this.peekStartsWith("//")&&this.capture("//");return this.capture(")"),routes},UrlParser}();exports.UrlParser=UrlParser,exports.parser=new UrlParser;var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;0<=i;i--)(d=decorators[i])&&(r=(c<3?d(r):3<c?d(target,key,r):d(target,key))||r);return 3<c&&r&&Object.defineProperty(target,key,r),r},RouteLifecycleHook=function(){function RouteLifecycleHook(name){this.name=name}return RouteLifecycleHook=__decorate([function(target){return target}],RouteLifecycleHook)}();exports.RouteLifecycleHook=RouteLifecycleHook;var CanActivate=function(){function CanActivate(fn){this.fn=fn}return CanActivate=__decorate([function(target){return target}],CanActivate)}();exports.CanActivate=CanActivate,exports.routerCanReuse=CONST_EXPR(new RouteLifecycleHook("routerCanReuse")),exports.routerCanDeactivate=CONST_EXPR(new RouteLifecycleHook("routerCanDeactivate")),exports.routerOnActivate=CONST_EXPR(new RouteLifecycleHook("routerOnActivate")),exports.routerOnReuse=CONST_EXPR(new RouteLifecycleHook("routerOnReuse")),exports.routerOnDeactivate=CONST_EXPR(new RouteLifecycleHook("routerOnDeactivate"));var lifecycle_annotations_impl_1=require();exports.hasLifecycleHook=function(e,type){return type instanceof Type&&e.name in type.prototype},exports.getCanActivateHook=function(type){for(var annotations=reflector.annotations(type),i=0;i<annotations.length;i+=1){var annotation=annotations[i];if(annotation instanceof lifecycle_annotations_impl_1.CanActivate)return annotation.fn}return null};var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},__decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;0<=i;i--)(d=decorators[i])&&(r=(c<3?d(r):3<c?d(target,key,r):d(target,key))||r);return 3<c&&r&&Object.defineProperty(target,key,r),r},route_definition_1=require();exports.RouteDefinition=route_definition_1.RouteDefinition;var RouteConfig=function(){function RouteConfig(configs){this.configs=configs}return RouteConfig=__decorate([function(target){return target}],RouteConfig)}();exports.RouteConfig=RouteConfig;var AbstractRoute=function(){function AbstractRoute(_a){var name=_a.name,useAsDefault=_a.useAsDefault,path=_a.path,regex=_a.regex,serializer=_a.serializer,data=_a.data;this.name=name,this.useAsDefault=useAsDefault,this.path=path,this.regex=regex,this.serializer=serializer,this.data=data}return AbstractRoute=__decorate([function(target){return target}],AbstractRoute)}(),Route=function(_super){function Route(_a){var name=_a.name,useAsDefault=_a.useAsDefault,path=_a.path,regex=_a.regex,serializer=_a.serializer,data=_a.data,component=_a.component;_super.call(this,{name:name,useAsDefault:useAsDefault,path:path,regex:regex,serializer:serializer,data:data}),this.aux=null,this.component=component}return __extends(Route,_super),Route=__decorate([function(target){return target}],Route)}(exports.AbstractRoute=AbstractRoute);exports.Route=Route;var AuxRoute=function(_super){function AuxRoute(_a){var name=_a.name,useAsDefault=_a.useAsDefault,path=_a.path,regex=_a.regex,serializer=_a.serializer,data=_a.data,component=_a.component;_super.call(this,{name:name,useAsDefault:useAsDefault,path:path,regex:regex,serializer:serializer,data:data}),this.component=component}return __extends(AuxRoute,_super),AuxRoute=__decorate([function(target){return target}],AuxRoute)}(AbstractRoute);exports.AuxRoute=AuxRoute;var AsyncRoute=function(_super){function AsyncRoute(_a){var name=_a.name,useAsDefault=_a.useAsDefault,path=_a.path,regex=_a.regex,serializer=_a.serializer,data=_a.data,loader=_a.loader;_super.call(this,{name:name,useAsDefault:useAsDefault,path:path,regex:regex,serializer:serializer,data:data}),this.aux=null,this.loader=loader}return __extends(AsyncRoute,_super),AsyncRoute=__decorate([function(target){return target}],AsyncRoute)}(AbstractRoute);exports.AsyncRoute=AsyncRoute;var Redirect=function(_super){function Redirect(_a){var name=_a.name,useAsDefault=_a.useAsDefault,path=_a.path,regex=_a.regex,serializer=_a.serializer,data=_a.data,redirectTo=_a.redirectTo;_super.call(this,{name:name,useAsDefault:useAsDefault,path:path,regex:regex,serializer:serializer,data:data}),this.redirectTo=redirectTo}return __extends(Redirect,_super),Redirect=__decorate([function(target){return target}],Redirect)}(AbstractRoute);exports.Redirect=Redirect;var route_config_decorator_1=require();function wrapLoaderToReconfigureRegistry(loader,registry){return function(){return loader().then(function(componentType){return registry.configFromComponent(componentType),componentType})}}exports.normalizeRouteConfig=function(config,registry){if(config instanceof route_config_decorator_1.AsyncRoute){var wrappedLoader=wrapLoaderToReconfigureRegistry(config.loader,registry);return new route_config_decorator_1.AsyncRoute({path:config.path,loader:wrappedLoader,name:config.name,data:config.data,useAsDefault:config.useAsDefault})}if(config instanceof route_config_decorator_1.Route||config instanceof route_config_decorator_1.Redirect||config instanceof route_config_decorator_1.AuxRoute)return config;if(+!!config.component+ +!!config.redirectTo+ +!!config.loader!=1)throw new BaseException('Route config should contain exactly one "component", "loader", or "redirectTo" property.');if(config.as&&config.name)throw new BaseException('Route config should contain exactly one "as" or "name" property.');config.as&&(config.name=config.as);if(config.loader){var wrappedLoader=wrapLoaderToReconfigureRegistry(config.loader,registry);return new route_config_decorator_1.AsyncRoute({path:config.path,loader:wrappedLoader,name:config.name,data:config.data,useAsDefault:config.useAsDefault})}if(config.aux)return new route_config_decorator_1.AuxRoute({path:config.aux,component:config.component,name:config.name});if(config.component){if("object"==typeof config.component){var componentDefinitionObject=config.component;if("constructor"==componentDefinitionObject.type)return new route_config_decorator_1.Route({path:config.path,component:componentDefinitionObject.constructor,name:config.name,data:config.data,useAsDefault:config.useAsDefault});if("loader"==componentDefinitionObject.type)return new route_config_decorator_1.AsyncRoute({path:config.path,loader:componentDefinitionObject.loader,name:config.name,data:config.data,useAsDefault:config.useAsDefault});throw new BaseException('Invalid component type "'+componentDefinitionObject.type+'". Valid types are "constructor" and "loader".')}return new route_config_decorator_1.Route(config)}if(config.redirectTo)return new route_config_decorator_1.Redirect({path:config.path,redirectTo:config.redirectTo});return config},exports.assertComponentExists=function(component,path){if(!isType(component))throw new BaseException('Component for route "'+path+'" is not defined, or is not a class.')};var instruction_1=require(),AsyncRouteHandler=function(){function AsyncRouteHandler(_loader,data){void 0===data&&(data=null),this._loader=_loader,this._resolvedComponent=null,this.data=isPresent(data)?new instruction_1.RouteData(data):instruction_1.BLANK_ROUTE_DATA}return AsyncRouteHandler.prototype.resolveComponentType=function(){var _this=this;return isPresent(this._resolvedComponent)?this._resolvedComponent:this._resolvedComponent=this._loader().then(function(componentType){return _this.componentType=componentType})},AsyncRouteHandler}();exports.AsyncRouteHandler=AsyncRouteHandler;var instruction_1=require(),SyncRouteHandler=function(){function SyncRouteHandler(componentType,data){this.componentType=componentType,this._resolvedComponent=null,this._resolvedComponent=PromiseWrapper.resolve(componentType),this.data=isPresent(data)?new instruction_1.RouteData(data):instruction_1.BLANK_ROUTE_DATA}return SyncRouteHandler.prototype.resolveComponentType=function(){return this._resolvedComponent},SyncRouteHandler}();exports.SyncRouteHandler=SyncRouteHandler;var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},url_parser_1=require(),instruction_1=require(),RouteMatch=function(){},PathMatch=function(_super){function PathMatch(instruction,remaining,remainingAux){_super.call(this),this.instruction=instruction,this.remaining=remaining,this.remainingAux=remainingAux}return __extends(PathMatch,_super),PathMatch}(exports.RouteMatch=RouteMatch);exports.PathMatch=PathMatch;var RedirectMatch=function(_super){function RedirectMatch(redirectTo,specificity){_super.call(this),this.redirectTo=redirectTo,this.specificity=specificity}return __extends(RedirectMatch,_super),RedirectMatch}(RouteMatch);exports.RedirectMatch=RedirectMatch;var RedirectRule=function(){function RedirectRule(_pathRecognizer,redirectTo){this._pathRecognizer=_pathRecognizer,this.redirectTo=redirectTo,this.hash=this._pathRecognizer.hash}return Object.defineProperty(RedirectRule.prototype,"path",{get:function(){return this._pathRecognizer.toString()},set:function(val){throw new BaseException("you cannot set the path of a RedirectRule directly")},enumerable:!0,configurable:!0}),RedirectRule.prototype.recognize=function(beginningSegment){var match=null;return isPresent(this._pathRecognizer.matchUrl(beginningSegment))&&(match=new RedirectMatch(this.redirectTo,this._pathRecognizer.specificity)),PromiseWrapper.resolve(match)},RedirectRule.prototype.generate=function(params){throw new BaseException("Tried to generate a redirect.")},RedirectRule}();exports.RedirectRule=RedirectRule;var RouteRule=function(){function RouteRule(_routePath,handler){this._routePath=_routePath,this.handler=handler,this._cache=new Map,this.specificity=this._routePath.specificity,this.hash=this._routePath.hash,this.terminal=this._routePath.terminal}return Object.defineProperty(RouteRule.prototype,"path",{get:function(){return this._routePath.toString()},set:function(val){throw new BaseException("you cannot set the path of a RouteRule directly")},enumerable:!0,configurable:!0}),RouteRule.prototype.recognize=function(beginningSegment){var _this=this,res=this._routePath.matchUrl(beginningSegment);return isBlank(res)?null:this.handler.resolveComponentType().then(function(_){var componentInstruction=_this._getInstruction(res.urlPath,res.urlParams,res.allParams);return new PathMatch(componentInstruction,res.rest,res.auxiliary)})},RouteRule.prototype.generate=function(params){var generated=this._routePath.generateUrl(params),urlPath=generated.urlPath,urlParams=generated.urlParams;return this._getInstruction(urlPath,url_parser_1.convertUrlParamsToArray(urlParams),params)},RouteRule.prototype.generateComponentPathValues=function(params){return this._routePath.generateUrl(params)},RouteRule.prototype._getInstruction=function(urlPath,urlParams,params){if(isBlank(this.handler.componentType))throw new BaseException("Tried to get instruction before the type was loaded.");var hashKey=urlPath+"?"+urlParams.join("&");if(this._cache.has(hashKey))return this._cache.get(hashKey);var instruction=new instruction_1.ComponentInstruction(urlPath,urlParams,this.handler.data,this.handler.componentType,this.terminal,this.specificity,params);return this._cache.set(hashKey,instruction),instruction},RouteRule}();exports.RouteRule=RouteRule;var rules_1=require(),route_config_impl_1=require(),async_route_handler_1=require(),sync_route_handler_1=require(),param_route_path_1=require(),regex_route_path_1=require(),RuleSet=function(){function RuleSet(){this.rulesByName=new Map,this.auxRulesByName=new Map,this.auxRulesByPath=new Map,this.rules=[],this.defaultRule=null}return RuleSet.prototype.config=function(config){var handler;if(isPresent(config.name)&&config.name[0].toUpperCase()!=config.name[0]){var suggestedName=config.name[0].toUpperCase()+config.name.substring(1);throw new BaseException('Route "'+config.path+'" with name "'+config.name+'" does not begin with an uppercase letter. Route names should be CamelCase like "'+suggestedName+'".')}if(config instanceof route_config_impl_1.AuxRoute){handler=new sync_route_handler_1.SyncRouteHandler(config.component,config.data);var routePath_1=this._getRoutePath(config),auxRule=new rules_1.RouteRule(routePath_1,handler);return this.auxRulesByPath.set(routePath_1.toString(),auxRule),isPresent(config.name)&&this.auxRulesByName.set(config.name,auxRule),auxRule.terminal}var useAsDefault=!1;if(config instanceof route_config_impl_1.Redirect){var routePath_2=this._getRoutePath(config),redirector=new rules_1.RedirectRule(routePath_2,config.redirectTo);return this._assertNoHashCollision(redirector.hash,config.path),this.rules.push(redirector),!0}config instanceof route_config_impl_1.Route?(handler=new sync_route_handler_1.SyncRouteHandler(config.component,config.data),useAsDefault=isPresent(config.useAsDefault)&&config.useAsDefault):config instanceof route_config_impl_1.AsyncRoute&&(handler=new async_route_handler_1.AsyncRouteHandler(config.loader,config.data),useAsDefault=isPresent(config.useAsDefault)&&config.useAsDefault);var routePath=this._getRoutePath(config),newRule=new rules_1.RouteRule(routePath,handler);if(this._assertNoHashCollision(newRule.hash,config.path),useAsDefault){if(isPresent(this.defaultRule))throw new BaseException("Only one route can be default");this.defaultRule=newRule}return this.rules.push(newRule),isPresent(config.name)&&this.rulesByName.set(config.name,newRule),newRule.terminal},RuleSet.prototype.recognize=function(urlParse){var solutions=[];return this.rules.forEach(function(routeRecognizer){var pathMatch=routeRecognizer.recognize(urlParse);isPresent(pathMatch)&&solutions.push(pathMatch)}),0==solutions.length&&isPresent(urlParse)&&0<urlParse.auxiliary.length?[PromiseWrapper.resolve(new rules_1.PathMatch(null,null,urlParse.auxiliary))]:solutions},RuleSet.prototype.recognizeAuxiliary=function(urlParse){var routeRecognizer=this.auxRulesByPath.get(urlParse.path);return isPresent(routeRecognizer)?[routeRecognizer.recognize(urlParse)]:[PromiseWrapper.resolve(null)]},RuleSet.prototype.hasRoute=function(name){return this.rulesByName.has(name)},RuleSet.prototype.componentLoaded=function(name){return this.hasRoute(name)&&isPresent(this.rulesByName.get(name).handler.componentType)},RuleSet.prototype.loadComponent=function(name){return this.rulesByName.get(name).handler.resolveComponentType()},RuleSet.prototype.generate=function(name,params){var rule=this.rulesByName.get(name);return isBlank(rule)?null:rule.generate(params)},RuleSet.prototype.generateAuxiliary=function(name,params){var rule=this.auxRulesByName.get(name);return isBlank(rule)?null:rule.generate(params)},RuleSet.prototype._assertNoHashCollision=function(hash,path){this.rules.forEach(function(rule){if(hash==rule.hash)throw new BaseException("Configuration '"+path+"' conflicts with existing route '"+rule.path+"'")})},RuleSet.prototype._getRoutePath=function(config){if(isPresent(config.regex)){if(isFunction(config.serializer))return new regex_route_path_1.RegexRoutePath(config.regex,config.serializer);throw new BaseException("Route provides a regex property, '"+config.regex+"', but no serializer property")}if(isPresent(config.path)){var path=config instanceof route_config_impl_1.AuxRoute&&config.path.startsWith("/")?config.path.substring(1):config.path;return new param_route_path_1.ParamRoutePath(path)}throw new BaseException("Route must provide either a path or regex property")},RuleSet}();exports.RuleSet=RuleSet;var MatchedUrl=function(urlPath,urlParams,allParams,auxiliary,rest){this.urlPath=urlPath,this.urlParams=urlParams,this.allParams=allParams,this.auxiliary=auxiliary,this.rest=rest};exports.MatchedUrl=MatchedUrl;var GeneratedUrl=function(urlPath,urlParams){this.urlPath=urlPath,this.urlParams=urlParams};exports.GeneratedUrl=GeneratedUrl;var utils_1=require(),url_parser_1=require(),route_path_1=require(),ContinuationPathSegment=function(){function ContinuationPathSegment(){this.name="",this.specificity="",this.hash="..."}return ContinuationPathSegment.prototype.generate=function(params){return""},ContinuationPathSegment.prototype.match=function(path){return!0},ContinuationPathSegment}(),StaticPathSegment=function(){function StaticPathSegment(path){this.path=path,this.name="",this.specificity="2",this.hash=path}return StaticPathSegment.prototype.match=function(path){return path==this.path},StaticPathSegment.prototype.generate=function(params){return this.path},StaticPathSegment}(),DynamicPathSegment=function(){function DynamicPathSegment(name){this.name=name,this.specificity="1",this.hash=":"}return DynamicPathSegment.prototype.match=function(path){return 0<path.length},DynamicPathSegment.prototype.generate=function(params){if(!StringMapWrapper.contains(params.map,this.name))throw new BaseException("Route generator for '"+this.name+"' was not included in parameters passed.");return utils_1.normalizeString(params.get(this.name))},DynamicPathSegment.paramMatcher=/^:([^\/]+)$/g,DynamicPathSegment}(),StarPathSegment=function(){function StarPathSegment(name){this.name=name,this.specificity="0",this.hash="*"}return StarPathSegment.prototype.match=function(path){return!0},StarPathSegment.prototype.generate=function(params){return utils_1.normalizeString(params.get(this.name))},StarPathSegment.wildcardMatcher=/^\*([^\/]+)$/g,StarPathSegment}(),ParamRoutePath=function(){function ParamRoutePath(routePath){this.routePath=routePath,this.terminal=!0,this._assertValidPath(routePath),this._parsePathString(routePath),this.specificity=this._calculateSpecificity(),this.hash=this._calculateHash();var lastSegment=this._segments[this._segments.length-1];this.terminal=!(lastSegment instanceof ContinuationPathSegment)}return ParamRoutePath.prototype.matchUrl=function(url){for(var currentUrlSegment,nextUrlSegment=url,positionalParams={},captured=[],i=0;i<this._segments.length;i+=1){var pathSegment=this._segments[i];if(currentUrlSegment=nextUrlSegment,pathSegment instanceof ContinuationPathSegment)break;if(isPresent(currentUrlSegment)){if(pathSegment instanceof StarPathSegment){positionalParams[pathSegment.name]=currentUrlSegment.toString(),captured.push(currentUrlSegment.toString()),nextUrlSegment=null;break}if(captured.push(currentUrlSegment.path),pathSegment instanceof DynamicPathSegment)positionalParams[pathSegment.name]=currentUrlSegment.path;else if(!pathSegment.match(currentUrlSegment.path))return null;nextUrlSegment=currentUrlSegment.child}else if(!pathSegment.match(""))return null}if(this.terminal&&isPresent(nextUrlSegment))return null;var urlPath=captured.join("/"),auxiliary=[],urlParams=[],allParams=positionalParams;if(isPresent(currentUrlSegment)){var paramsSegment=url instanceof url_parser_1.RootUrl?url:currentUrlSegment;isPresent(paramsSegment.params)?(allParams=StringMapWrapper.merge(paramsSegment.params,positionalParams),urlParams=url_parser_1.convertUrlParamsToArray(paramsSegment.params)):allParams=positionalParams,auxiliary=currentUrlSegment.auxiliary}return new route_path_1.MatchedUrl(urlPath,urlParams,allParams,auxiliary,nextUrlSegment)},ParamRoutePath.prototype.generateUrl=function(params){for(var paramTokens=new utils_1.TouchMap(params),path=[],i=0;i<this._segments.length;i++){var segment=this._segments[i];segment instanceof ContinuationPathSegment||path.push(segment.generate(paramTokens))}var urlPath=path.join("/"),nonPositionalParams=paramTokens.getUnused(),urlParams=nonPositionalParams;return new route_path_1.GeneratedUrl(urlPath,urlParams)},ParamRoutePath.prototype.toString=function(){return this.routePath},ParamRoutePath.prototype._parsePathString=function(routePath){routePath.startsWith("/")&&(routePath=routePath.substring(1));var segmentStrings=routePath.split("/");this._segments=[];for(var limit=segmentStrings.length-1,i=0;i<=limit;i++){var match,segment=segmentStrings[i];if(isPresent(match=RegExpWrapper.firstMatch(DynamicPathSegment.paramMatcher,segment)))this._segments.push(new DynamicPathSegment(match[1]));else if(isPresent(match=RegExpWrapper.firstMatch(StarPathSegment.wildcardMatcher,segment)))this._segments.push(new StarPathSegment(match[1]));else if("..."==segment){if(i<limit)throw new BaseException('Unexpected "..." before the end of the path for "'+routePath+'".');this._segments.push(new ContinuationPathSegment)}else this._segments.push(new StaticPathSegment(segment))}},ParamRoutePath.prototype._calculateSpecificity=function(){var i,specificity,length=this._segments.length;if(0==length)specificity+="2";else for(specificity="",i=0;i<length;i++)specificity+=this._segments[i].specificity;return specificity},ParamRoutePath.prototype._calculateHash=function(){var i,length=this._segments.length,hashParts=[];for(i=0;i<length;i++)hashParts.push(this._segments[i].hash);return hashParts.join("/")},ParamRoutePath.prototype._assertValidPath=function(path){if(StringWrapper.contains(path,"#"))throw new BaseException('Path "'+path+'" should not include "#". Use "HashLocationStrategy" instead.');var illegalCharacter=RegExpWrapper.firstMatch(ParamRoutePath.RESERVED_CHARS,path);if(isPresent(illegalCharacter))throw new BaseException('Path "'+path+'" contains "'+illegalCharacter[0]+'" which is not allowed in a route config.')},ParamRoutePath.RESERVED_CHARS=RegExpWrapper.create("//|\\(|\\)|;|\\?|="),ParamRoutePath}();exports.ParamRoutePath=ParamRoutePath;var route_path_1=require(),RegexRoutePath=function(){function RegexRoutePath(_reString,_serializer){this._reString=_reString,this._serializer=_serializer,this.terminal=!0,this.specificity="2",this.hash=this._reString,this._regex=RegExpWrapper.create(this._reString)}return RegexRoutePath.prototype.matchUrl=function(url){var urlPath=url.toString(),params={},matcher=RegExpWrapper.matcher(this._regex,urlPath),match=RegExpMatcherWrapper.next(matcher);if(isBlank(match))return null;for(var i=0;i<match.length;i+=1)params[i.toString()]=match[i];return new route_path_1.MatchedUrl(urlPath,[],params,[],null)},RegexRoutePath.prototype.generateUrl=function(params){return this._serializer(params)},RegexRoutePath.prototype.toString=function(){return this._reString},RegexRoutePath}();exports.RegexRoutePath=RegexRoutePath;var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},RouteParams=function(){function RouteParams(params){this.params=params}return RouteParams.prototype.get=function(param){return normalizeBlank(StringMapWrapper.get(this.params,param))},RouteParams}();exports.RouteParams=RouteParams;var RouteData=function(){function RouteData(data){void 0===data&&(data=CONST_EXPR({})),this.data=data}return RouteData.prototype.get=function(key){return normalizeBlank(StringMapWrapper.get(this.data,key))},RouteData}();exports.RouteData=RouteData,exports.BLANK_ROUTE_DATA=new RouteData;var Instruction=function(){function Instruction(component,child,auxInstruction){this.component=component,this.child=child,this.auxInstruction=auxInstruction}return Object.defineProperty(Instruction.prototype,"urlPath",{get:function(){return isPresent(this.component)?this.component.urlPath:""},enumerable:!0,configurable:!0}),Object.defineProperty(Instruction.prototype,"urlParams",{get:function(){return isPresent(this.component)?this.component.urlParams:[]},enumerable:!0,configurable:!0}),Object.defineProperty(Instruction.prototype,"specificity",{get:function(){var total="";return isPresent(this.component)&&(total+=this.component.specificity),isPresent(this.child)&&(total+=this.child.specificity),total},enumerable:!0,configurable:!0}),Instruction.prototype.toRootUrl=function(){return this.toUrlPath()+this.toUrlQuery()},Instruction.prototype._toNonRootUrl=function(){return this._stringifyPathMatrixAuxPrefixed()+(isPresent(this.child)?this.child._toNonRootUrl():"")},Instruction.prototype.toUrlQuery=function(){return 0<this.urlParams.length?"?"+this.urlParams.join("&"):""},Instruction.prototype.replaceChild=function(child){return new ResolvedInstruction(this.component,child,this.auxInstruction)},Instruction.prototype.toUrlPath=function(){return this.urlPath+this._stringifyAux()+(isPresent(this.child)?this.child._toNonRootUrl():"")},Instruction.prototype.toLinkUrl=function(){return this.urlPath+this._stringifyAux()+(isPresent(this.child)?this.child._toLinkUrl():"")},Instruction.prototype._toLinkUrl=function(){return this._stringifyPathMatrixAuxPrefixed()+(isPresent(this.child)?this.child._toLinkUrl():"")},Instruction.prototype._stringifyPathMatrixAuxPrefixed=function(){var primary=this._stringifyPathMatrixAux();return 0<primary.length&&(primary="/"+primary),primary},Instruction.prototype._stringifyMatrixParams=function(){return 0<this.urlParams.length?";"+this.urlParams.join(";"):""},Instruction.prototype._stringifyPathMatrixAux=function(){return isBlank(this.component)?"":this.urlPath+this._stringifyMatrixParams()+this._stringifyAux()},Instruction.prototype._stringifyAux=function(){var routes=[];return StringMapWrapper.forEach(this.auxInstruction,function(auxInstruction,_){routes.push(auxInstruction._stringifyPathMatrixAux())}),0<routes.length?"("+routes.join("//")+")":""},Instruction}(),ResolvedInstruction=function(_super){function ResolvedInstruction(component,child,auxInstruction){_super.call(this,component,child,auxInstruction)}return __extends(ResolvedInstruction,_super),ResolvedInstruction.prototype.resolveComponent=function(){return PromiseWrapper.resolve(this.component)},ResolvedInstruction}(exports.Instruction=Instruction),DefaultInstruction=function(_super){function DefaultInstruction(component,child){_super.call(this,component,child,{})}return __extends(DefaultInstruction,_super),DefaultInstruction.prototype.toLinkUrl=function(){return""},DefaultInstruction.prototype._toLinkUrl=function(){return""},DefaultInstruction}(exports.ResolvedInstruction=ResolvedInstruction);exports.DefaultInstruction=DefaultInstruction;var UnresolvedInstruction=function(_super){function UnresolvedInstruction(_resolver,_urlPath,_urlParams){void 0===_urlPath&&(_urlPath=""),void 0===_urlParams&&(_urlParams=CONST_EXPR([])),_super.call(this,null,null,{}),this._resolver=_resolver,this._urlPath=_urlPath,this._urlParams=_urlParams}return __extends(UnresolvedInstruction,_super),Object.defineProperty(UnresolvedInstruction.prototype,"urlPath",{get:function(){return isPresent(this.component)?this.component.urlPath:isPresent(this._urlPath)?this._urlPath:""},enumerable:!0,configurable:!0}),Object.defineProperty(UnresolvedInstruction.prototype,"urlParams",{get:function(){return isPresent(this.component)?this.component.urlParams:isPresent(this._urlParams)?this._urlParams:[]},enumerable:!0,configurable:!0}),UnresolvedInstruction.prototype.resolveComponent=function(){var _this=this;return isPresent(this.component)?PromiseWrapper.resolve(this.component):this._resolver().then(function(resolution){return _this.child=resolution.child,_this.component=resolution.component})},UnresolvedInstruction}(Instruction);exports.UnresolvedInstruction=UnresolvedInstruction;var RedirectInstruction=function(_super){function RedirectInstruction(component,child,auxInstruction,_specificity){_super.call(this,component,child,auxInstruction),this._specificity=_specificity}return __extends(RedirectInstruction,_super),Object.defineProperty(RedirectInstruction.prototype,"specificity",{get:function(){return this._specificity},enumerable:!0,configurable:!0}),RedirectInstruction}(ResolvedInstruction);exports.RedirectInstruction=RedirectInstruction;var ComponentInstruction=function(urlPath,urlParams,data,componentType,terminal,specificity,params){void 0===params&&(params=null),this.urlPath=urlPath,this.urlParams=urlParams,this.componentType=componentType,this.terminal=terminal,this.specificity=specificity,this.params=params,this.reuse=!1,this.routeData=isPresent(data)?data:exports.BLANK_ROUTE_DATA};exports.ComponentInstruction=ComponentInstruction;var core_1=require(),route_config_impl_1=require(),rules_1=require(),rule_set_1=require(),instruction_1=require(),route_config_normalizer_1=require(),url_parser_1=require(),_resolveToNull=PromiseWrapper.resolve(null);exports.ROUTER_PRIMARY_COMPONENT=CONST_EXPR(new core_1.OpaqueToken("RouterPrimaryComponent"));var RouteRegistry=function(){function RouteRegistry(_rootComponent){this._rootComponent=_rootComponent,this._rules=new Map}return RouteRegistry.prototype.config=function(parentComponent,config){(config=route_config_normalizer_1.normalizeRouteConfig(config,this))instanceof route_config_impl_1.Route?route_config_normalizer_1.assertComponentExists(config.component,config.path):config instanceof route_config_impl_1.AuxRoute&&route_config_normalizer_1.assertComponentExists(config.component,config.path);var rules=this._rules.get(parentComponent);isBlank(rules)&&(rules=new rule_set_1.RuleSet,this._rules.set(parentComponent,rules));var terminal=rules.config(config);config instanceof route_config_impl_1.Route&&(terminal?function(component,path){if(!isType(component))return;var annotations=reflector.annotations(component);if(isPresent(annotations))for(var i=0;i<annotations.length;i++){var annotation=annotations[i];if(annotation instanceof route_config_impl_1.RouteConfig)throw new BaseException('Child routes are not allowed for "'+path+'". Use "..." on the parent\'s route path.')}}(config.component,config.path):this.configFromComponent(config.component))},RouteRegistry.prototype.configFromComponent=function(component){var _this=this;if(isType(component)&&!this._rules.has(component)){var annotations=reflector.annotations(component);if(isPresent(annotations))for(var i=0;i<annotations.length;i++){var annotation=annotations[i];if(annotation instanceof route_config_impl_1.RouteConfig){var routeCfgs=annotation.configs;routeCfgs.forEach(function(config){return _this.config(component,config)})}}}},RouteRegistry.prototype.recognize=function(url,ancestorInstructions){var parsedUrl=url_parser_1.parser.parse(url);return this._recognize(parsedUrl,[])},RouteRegistry.prototype._recognize=function(parsedUrl,ancestorInstructions,_aux){var _this=this;void 0===_aux&&(_aux=!1);var parentInstruction=ListWrapper.last(ancestorInstructions),parentComponent=isPresent(parentInstruction)?parentInstruction.component.componentType:this._rootComponent,rules=this._rules.get(parentComponent);if(isBlank(rules))return _resolveToNull;var possibleMatches=_aux?rules.recognizeAuxiliary(parsedUrl):rules.recognize(parsedUrl),matchPromises=possibleMatches.map(function(candidate){return candidate.then(function(candidate){if(candidate instanceof rules_1.PathMatch){var auxParentInstructions=0<ancestorInstructions.length?[ListWrapper.last(ancestorInstructions)]:[],auxInstructions=_this._auxRoutesToUnresolved(candidate.remainingAux,auxParentInstructions),instruction=new instruction_1.ResolvedInstruction(candidate.instruction,null,auxInstructions);if(isBlank(candidate.instruction)||candidate.instruction.terminal)return instruction;var newAncestorInstructions=ancestorInstructions.concat([instruction]);return _this._recognize(candidate.remaining,newAncestorInstructions).then(function(childInstruction){return isBlank(childInstruction)?null:childInstruction instanceof instruction_1.RedirectInstruction?childInstruction:(instruction.child=childInstruction,instruction)})}if(candidate instanceof rules_1.RedirectMatch){var instruction=_this.generate(candidate.redirectTo,ancestorInstructions.concat([null]));return new instruction_1.RedirectInstruction(instruction.component,instruction.child,instruction.auxInstruction,candidate.specificity)}})});return!isBlank(parsedUrl)&&""!=parsedUrl.path||0!=possibleMatches.length?PromiseWrapper.all(matchPromises).then(mostSpecific):PromiseWrapper.resolve(this.generateDefault(parentComponent))},RouteRegistry.prototype._auxRoutesToUnresolved=function(auxRoutes,parentInstructions){var _this=this,unresolvedAuxInstructions={};return auxRoutes.forEach(function(auxUrl){unresolvedAuxInstructions[auxUrl.path]=new instruction_1.UnresolvedInstruction(function(){return _this._recognize(auxUrl,parentInstructions,!0)})}),unresolvedAuxInstructions},RouteRegistry.prototype.generate=function(linkParams,ancestorInstructions,_aux){void 0===_aux&&(_aux=!1);var prevInstruction,params=function(linkParams){var accumulation=[];return linkParams.forEach(function(item){if(isString(item)){var strItem=item;accumulation=accumulation.concat(strItem.split("/"))}else accumulation.push(item)}),accumulation}(linkParams);if(""==ListWrapper.first(params))params.shift(),prevInstruction=ListWrapper.first(ancestorInstructions),ancestorInstructions=[];else if(prevInstruction=0<ancestorInstructions.length?ancestorInstructions.pop():null,"."==ListWrapper.first(params))params.shift();else if(".."==ListWrapper.first(params))for(;".."==ListWrapper.first(params);){if(ancestorInstructions.length<=0)throw new BaseException('Link "'+ListWrapper.toJSON(linkParams)+'" has too many "../" segments.');prevInstruction=ancestorInstructions.pop(),params=ListWrapper.slice(params,1)}else{var routeName=ListWrapper.first(params),parentComponentType=this._rootComponent,grandparentComponentType=null;if(1<ancestorInstructions.length){var parentComponentInstruction=ancestorInstructions[ancestorInstructions.length-1],grandComponentInstruction=ancestorInstructions[ancestorInstructions.length-2];parentComponentType=parentComponentInstruction.component.componentType,grandparentComponentType=grandComponentInstruction.component.componentType}else 1==ancestorInstructions.length&&(parentComponentType=ancestorInstructions[0].component.componentType,grandparentComponentType=this._rootComponent);var childRouteExists=this.hasRoute(routeName,parentComponentType),parentRouteExists=isPresent(grandparentComponentType)&&this.hasRoute(routeName,grandparentComponentType);if(parentRouteExists&&childRouteExists){var msg='Link "'+ListWrapper.toJSON(linkParams)+'" is ambiguous, use "./" or "../" to disambiguate.';throw new BaseException(msg)}parentRouteExists&&(prevInstruction=ancestorInstructions.pop())}if(""==params[params.length-1]&&params.pop(),0<params.length&&""==params[0]&&params.shift(),params.length<1){var msg='Link "'+ListWrapper.toJSON(linkParams)+'" must include a route name.';throw new BaseException(msg)}for(var generatedInstruction=this._generate(params,ancestorInstructions,prevInstruction,_aux,linkParams),i=ancestorInstructions.length-1;0<=i;i--){var ancestorInstruction=ancestorInstructions[i];if(isBlank(ancestorInstruction))break;generatedInstruction=ancestorInstruction.replaceChild(generatedInstruction)}return generatedInstruction},RouteRegistry.prototype._generate=function(linkParams,ancestorInstructions,prevInstruction,_aux,_originalLink){var _this=this;void 0===_aux&&(_aux=!1);var parentComponentType=this._rootComponent,componentInstruction=null,auxInstructions={},parentInstruction=ListWrapper.last(ancestorInstructions);if(isPresent(parentInstruction)&&isPresent(parentInstruction.component)&&(parentComponentType=parentInstruction.component.componentType),0==linkParams.length){var defaultInstruction=this.generateDefault(parentComponentType);if(isBlank(defaultInstruction))throw new BaseException('Link "'+ListWrapper.toJSON(_originalLink)+'" does not resolve to a terminal instruction.');return defaultInstruction}isPresent(prevInstruction)&&!_aux&&(auxInstructions=StringMapWrapper.merge(prevInstruction.auxInstruction,auxInstructions),componentInstruction=prevInstruction.component);var rules=this._rules.get(parentComponentType);if(isBlank(rules))throw new BaseException('Component "'+getTypeNameForDebugging(parentComponentType)+'" has no route config.');var obj,linkParamIndex=0,routeParams={};if(linkParamIndex<linkParams.length&&isString(linkParams[linkParamIndex])){var routeName=linkParams[linkParamIndex];if(""==routeName||"."==routeName||".."==routeName)throw new BaseException('"'+routeName+'/" is only allowed at the beginning of a link DSL.');if((linkParamIndex+=1)<linkParams.length){var linkParam=linkParams[linkParamIndex];"object"!=typeof(obj=linkParam)||null===obj||isArray(linkParam)||(routeParams=linkParam,linkParamIndex+=1)}var routeRecognizer=(_aux?rules.auxRulesByName:rules.rulesByName).get(routeName);if(isBlank(routeRecognizer))throw new BaseException('Component "'+getTypeNameForDebugging(parentComponentType)+'" has no route named "'+routeName+'".');if(isBlank(routeRecognizer.handler.componentType)){var generatedUrl=routeRecognizer.generateComponentPathValues(routeParams);return new instruction_1.UnresolvedInstruction(function(){return routeRecognizer.handler.resolveComponentType().then(function(_){return _this._generate(linkParams,ancestorInstructions,prevInstruction,_aux,_originalLink)})},generatedUrl.urlPath,url_parser_1.convertUrlParamsToArray(generatedUrl.urlParams))}componentInstruction=_aux?rules.generateAuxiliary(routeName,routeParams):rules.generate(routeName,routeParams)}for(;linkParamIndex<linkParams.length&&isArray(linkParams[linkParamIndex]);){var auxParentInstruction=[parentInstruction],auxInstruction=this._generate(linkParams[linkParamIndex],auxParentInstruction,null,!0,_originalLink);auxInstructions[auxInstruction.component.urlPath]=auxInstruction,linkParamIndex+=1}var instruction=new instruction_1.ResolvedInstruction(componentInstruction,null,auxInstructions);if(isPresent(componentInstruction)&&isPresent(componentInstruction.componentType)){var childInstruction=null;if(componentInstruction.terminal)linkParams.length;else{var childAncestorComponents=ancestorInstructions.concat([instruction]),remainingLinkParams=linkParams.slice(linkParamIndex);childInstruction=this._generate(remainingLinkParams,childAncestorComponents,null,!1,_originalLink)}instruction.child=childInstruction}return instruction},RouteRegistry.prototype.hasRoute=function(name,parentComponent){var rules=this._rules.get(parentComponent);return!isBlank(rules)&&rules.hasRoute(name)},RouteRegistry.prototype.generateDefault=function(componentCursor){var _this=this;if(isBlank(componentCursor))return null;var rules=this._rules.get(componentCursor);if(isBlank(rules)||isBlank(rules.defaultRule))return null;var defaultChild=null;if(isPresent(rules.defaultRule.handler.componentType)){var componentInstruction=rules.defaultRule.generate({});return rules.defaultRule.terminal||(defaultChild=this.generateDefault(rules.defaultRule.handler.componentType)),new instruction_1.DefaultInstruction(componentInstruction,defaultChild)}return new instruction_1.UnresolvedInstruction(function(){return rules.defaultRule.handler.resolveComponentType().then(function(_){return _this.generateDefault(componentCursor)})})},RouteRegistry}();function mostSpecific(instructions){if(0==(instructions=instructions.filter(function(instruction){return isPresent(instruction)})).length)return null;if(1==instructions.length)return instructions[0];var first=instructions[0],rest=instructions.slice(1);return rest.reduce(function(instruction,contender){return-1==function(a,b){for(var l=Math.min(a.length,b.length),i=0;i<l;i+=1){var ai=StringWrapper.charCodeAt(a,i),bi=StringWrapper.charCodeAt(b,i),difference=bi-ai;if(0!=difference)return difference}return a.length-b.length}(contender.specificity,instruction.specificity)?contender:instruction},first)}exports.RouteRegistry=RouteRegistry;var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},route_lifecycle_reflector_1=require(),_resolveToTrue=PromiseWrapper.resolve(!0),_resolveToFalse=PromiseWrapper.resolve(!1),Router=function(){function Router(registry,parent,hostComponent){this.registry=registry,this.parent=parent,this.hostComponent=hostComponent,this.navigating=!1,this._currentInstruction=null,this._currentNavigation=_resolveToTrue,this._outlet=null,this._auxRouters=new Map,this._subject=new EventEmitter}return Router.prototype.childRouter=function(hostComponent){return this._childRouter=new ChildRouter(this,hostComponent)},Router.prototype.auxRouter=function(hostComponent){return new ChildRouter(this,hostComponent)},Router.prototype.registerPrimaryOutlet=function(outlet){if(isPresent(outlet.name))throw new BaseException("registerPrimaryOutlet expects to be called with an unnamed outlet.");if(isPresent(this._outlet))throw new BaseException("Primary outlet is already registered.");return this._outlet=outlet,isPresent(this._currentInstruction)?this.commit(this._currentInstruction,!1):_resolveToTrue},Router.prototype.unregisterPrimaryOutlet=function(outlet){if(isPresent(outlet.name))throw new BaseException("registerPrimaryOutlet expects to be called with an unnamed outlet.");this._outlet=null},Router.prototype.registerAuxOutlet=function(outlet){var outletName=outlet.name;if(isBlank(outletName))throw new BaseException("registerAuxOutlet expects to be called with an outlet with a name.");var auxInstruction,router=this.auxRouter(this.hostComponent);return this._auxRouters.set(outletName,router),router._outlet=outlet,isPresent(this._currentInstruction)&&isPresent(auxInstruction=this._currentInstruction.auxInstruction[outletName])?router.commit(auxInstruction):_resolveToTrue},Router.prototype.isRouteActive=function(instruction){for(var router=this;isPresent(router.parent)&&isPresent(instruction.child);)router=router.parent,instruction=instruction.child;return isPresent(this._currentInstruction)&&this._currentInstruction.component==instruction.component},Router.prototype.config=function(definitions){var _this=this;return definitions.forEach(function(routeDefinition){_this.registry.config(_this.hostComponent,routeDefinition)}),this.renavigate()},Router.prototype.navigate=function(linkParams){var instruction=this.generate(linkParams);return this.navigateByInstruction(instruction,!1)},Router.prototype.navigateByUrl=function(url,_skipLocationChange){var _this=this;return void 0===_skipLocationChange&&(_skipLocationChange=!1),this._currentNavigation=this._currentNavigation.then(function(_){return _this.lastNavigationAttempt=url,_this._startNavigating(),_this._afterPromiseFinishNavigating(_this.recognize(url).then(function(instruction){return!isBlank(instruction)&&_this._navigate(instruction,_skipLocationChange)}))})},Router.prototype.navigateByInstruction=function(instruction,_skipLocationChange){var _this=this;return void 0===_skipLocationChange&&(_skipLocationChange=!1),isBlank(instruction)?_resolveToFalse:this._currentNavigation=this._currentNavigation.then(function(_){return _this._startNavigating(),_this._afterPromiseFinishNavigating(_this._navigate(instruction,_skipLocationChange))})},Router.prototype._settleInstruction=function(instruction){var _this=this;return instruction.resolveComponent().then(function(_){var unsettledInstructions=[];return isPresent(instruction.component)&&(instruction.component.reuse=!1),isPresent(instruction.child)&&unsettledInstructions.push(_this._settleInstruction(instruction.child)),StringMapWrapper.forEach(instruction.auxInstruction,function(instruction,_){unsettledInstructions.push(_this._settleInstruction(instruction))}),PromiseWrapper.all(unsettledInstructions)})},Router.prototype._navigate=function(instruction,_skipLocationChange){var _this=this;return this._settleInstruction(instruction).then(function(_){return _this._routerCanReuse(instruction)}).then(function(_){return _this._canActivate(instruction)}).then(function(result){return!!result&&_this._routerCanDeactivate(instruction).then(function(result){if(result)return _this.commit(instruction,_skipLocationChange).then(function(_){return _this._emitNavigationFinish(instruction.toRootUrl()),!0})})})},Router.prototype._emitNavigationFinish=function(url){ObservableWrapper.callEmit(this._subject,url)},Router.prototype._afterPromiseFinishNavigating=function(promise){var _this=this;return PromiseWrapper.catchError(promise.then(function(_){return _this._finishNavigating()}),function(err){throw _this._finishNavigating(),err})},Router.prototype._routerCanReuse=function(instruction){var _this=this;return isBlank(this._outlet)?_resolveToFalse:isBlank(instruction.component)?_resolveToTrue:this._outlet.routerCanReuse(instruction.component).then(function(result){if((instruction.component.reuse=result)&&isPresent(_this._childRouter)&&isPresent(instruction.child))return _this._childRouter._routerCanReuse(instruction.child)})},Router.prototype._canActivate=function(nextInstruction){return function canActivateOne(nextInstruction,prevInstruction){var next=_resolveToTrue;if(isBlank(nextInstruction.component))return next;isPresent(nextInstruction.child)&&(next=canActivateOne(nextInstruction.child,isPresent(prevInstruction)?prevInstruction.child:null));return next.then(function(result){if(0==result)return!1;if(nextInstruction.component.reuse)return!0;var hook=route_lifecycle_reflector_1.getCanActivateHook(nextInstruction.component.componentType);return!isPresent(hook)||hook(nextInstruction.component,isPresent(prevInstruction)?prevInstruction.component:null)})}(nextInstruction,this._currentInstruction)},Router.prototype._routerCanDeactivate=function(instruction){var _this=this;if(isBlank(this._outlet))return _resolveToTrue;var childInstruction=null,reuse=!1,componentInstruction=null;return isPresent(instruction)&&(childInstruction=instruction.child,componentInstruction=instruction.component,reuse=isBlank(instruction.component)||instruction.component.reuse),(reuse?_resolveToTrue:this._outlet.routerCanDeactivate(componentInstruction)).then(function(result){return 0!=result&&(!isPresent(_this._childRouter)||_this._childRouter._routerCanDeactivate(childInstruction))})},Router.prototype.commit=function(instruction,_skipLocationChange){var _this=this;void 0===_skipLocationChange&&(_skipLocationChange=!1),this._currentInstruction=instruction;var next=_resolveToTrue;if(isPresent(this._outlet)&&isPresent(instruction.component)){var componentInstruction=instruction.component;next=componentInstruction.reuse?this._outlet.reuse(componentInstruction):this.deactivate(instruction).then(function(_){return _this._outlet.activate(componentInstruction)}),isPresent(instruction.child)&&(next=next.then(function(_){if(isPresent(_this._childRouter))return _this._childRouter.commit(instruction.child)}))}var promises=[];return this._auxRouters.forEach(function(router,name){isPresent(instruction.auxInstruction[name])&&promises.push(router.commit(instruction.auxInstruction[name]))}),next.then(function(_){return PromiseWrapper.all(promises)})},Router.prototype._startNavigating=function(){this.navigating=!0},Router.prototype._finishNavigating=function(){this.navigating=!1},Router.prototype.subscribe=function(onNext){return ObservableWrapper.subscribe(this._subject,onNext)},Router.prototype.deactivate=function(instruction){var _this=this,childInstruction=null,componentInstruction=null;isPresent(instruction)&&(childInstruction=instruction.child,componentInstruction=instruction.component);var next=_resolveToTrue;return isPresent(this._childRouter)&&(next=this._childRouter.deactivate(childInstruction)),isPresent(this._outlet)&&(next=next.then(function(_){return _this._outlet.deactivate(componentInstruction)})),next},Router.prototype.recognize=function(url){var ancestorComponents=this._getAncestorInstructions();return this.registry.recognize(url,ancestorComponents)},Router.prototype._getAncestorInstructions=function(){for(var ancestorInstructions=[this._currentInstruction],ancestorRouter=this;isPresent(ancestorRouter=ancestorRouter.parent);)ancestorInstructions.unshift(ancestorRouter._currentInstruction);return ancestorInstructions},Router.prototype.renavigate=function(){return isBlank(this.lastNavigationAttempt)?this._currentNavigation:this.navigateByUrl(this.lastNavigationAttempt)},Router.prototype.generate=function(linkParams){var ancestorInstructions=this._getAncestorInstructions();return this.registry.generate(linkParams,ancestorInstructions)},Router}(),RootRouter=function(_super){function RootRouter(registry,location,primaryComponent){var _this=this;_super.call(this,registry,null,primaryComponent),this._location=location,this._locationSub=this._location.subscribe(function(change){_this.recognize(change.url).then(function(instruction){_this.navigateByInstruction(instruction,isPresent(change.pop)).then(function(_){if(!isPresent(change.pop)||"hashchange"==change.type){var emitPath=instruction.toUrlPath(),emitQuery=instruction.toUrlQuery();0<emitPath.length&&"/"!=emitPath[0]&&(emitPath="/"+emitPath),"hashchange"==change.type?instruction.toRootUrl()!=_this._location.path()&&_this._location.replaceState(emitPath,emitQuery):_this._location.go(emitPath,emitQuery)}})})}),this.registry.configFromComponent(primaryComponent),this.navigateByUrl(location.path())}return __extends(RootRouter,_super),RootRouter.prototype.commit=function(instruction,_skipLocationChange){var _this=this;void 0===_skipLocationChange&&(_skipLocationChange=!1);var emitPath=instruction.toUrlPath(),emitQuery=instruction.toUrlQuery();0<emitPath.length&&"/"!=emitPath[0]&&(emitPath="/"+emitPath);var promise=_super.prototype.commit.call(this,instruction);return _skipLocationChange||(promise=promise.then(function(_){_this._location.go(emitPath,emitQuery)})),promise},RootRouter.prototype.dispose=function(){isPresent(this._locationSub)&&(ObservableWrapper.dispose(this._locationSub),this._locationSub=null)},RootRouter}(exports.Router=Router);exports.RootRouter=RootRouter;var ChildRouter=function(_super){function ChildRouter(parent,hostComponent){_super.call(this,parent.registry,parent,hostComponent),this.parent=parent}return __extends(ChildRouter,_super),ChildRouter.prototype.navigateByUrl=function(url,_skipLocationChange){return void 0===_skipLocationChange&&(_skipLocationChange=!1),this.parent.navigateByUrl(url,_skipLocationChange)},ChildRouter.prototype.navigateByInstruction=function(instruction,_skipLocationChange){return void 0===_skipLocationChange&&(_skipLocationChange=!1),this.parent.navigateByInstruction(instruction,_skipLocationChange)},ChildRouter}(Router);exports.getCanActivateHook=function(directiveName){var factory=$$directiveIntrospector.getTypeByName(directiveName);return factory&&factory.$canActivate&&function(next,prev){return $injector.invoke(factory.$canActivate,null,{$nextInstruction:next,$prevInstruction:prev})}},exports.assertComponentExists=function(){},angular.stringifyInstruction=function(instruction){return instruction.toRootUrl()};var RouteRegistry=exports.RouteRegistry,RootRouter=exports.RootRouter,registry=new RouteRegistry($routerRootComponent),location=new Location;$$directiveIntrospector(function(name,factory){angular.isArray(factory.$routeConfig)&&factory.$routeConfig.forEach(function(config){registry.config(name,config)})});var router=new RootRouter(registry,location,$routerRootComponent);return $rootScope.$watch(function(){return $location.url()},function(path){router.lastNavigationAttempt!==path&&router.navigateByUrl(path)}),router.subscribe(function(){$rootScope.$broadcast("$routeChangeSuccess",{})}),router}])}();